import { interpolate } from "flubber";

import Image from "next/image";

import React, { useState, useEffect } from "react";

import { motion, useMotionValue, useTransform, animate } from "framer-motion";
import { useInView } from "react-intersection-observer";
import { getIndex, useFlubber } from "./useFlubber.js";

import night from "../public/icon-night.svg";
import day from "../public/icon-day.svg";

let dark =
  "M23.9732 0.000209169C23.0287 0.0149734 22.2745 0.791657 22.2875 1.73619V6.87391C22.2787 7.49152 22.6032 8.066 23.1367 8.37735C23.6701 8.68871 24.3299 8.68871 24.8633 8.37735C25.3968 8.066 25.7213 7.49152 25.7125 6.87391V1.73619C25.7189 1.27329 25.5376 0.827527 25.2099 0.500486C24.8822 0.173445 24.4361 -0.00702084 23.9732 0.000209169ZM8.23828 6.5293C7.54201 6.53084 6.91598 6.95374 6.65461 7.5991C6.39324 8.24446 6.54856 8.98382 7.04752 9.46944L10.68 13.102C11.1095 13.5493 11.7474 13.7296 12.3475 13.5731C12.9476 13.4166 13.4163 12.948 13.5728 12.3478C13.7292 11.7477 13.549 11.1098 13.1016 10.6803L9.46917 7.04776C9.14594 6.71549 8.70183 6.52843 8.23828 6.5293ZM38.5299 7.04784C38.84 6.72859 39.2623 6.54264 39.7072 6.52939C40.4133 6.50856 41.0597 6.92334 41.335 7.57385C41.6103 8.22437 41.458 8.97717 40.9515 9.46952L37.319 13.102C36.8895 13.5494 36.2517 13.7296 35.6515 13.5732C35.0514 13.4167 34.5827 12.948 34.4263 12.3479C34.2698 11.7477 34.45 11.1099 34.8974 10.6804L38.5299 7.04784ZM24 12.0116C17.3793 12.0116 12.0122 17.3788 12.0122 23.9996C12.0122 30.6204 17.3793 35.9876 24 35.9876C30.6207 35.9876 35.9878 30.6204 35.9878 23.9996C35.9878 17.3788 30.6207 12.0116 24 12.0116ZM0.233513 23.1363C0.544865 22.6028 1.11933 22.2783 1.73693 22.287H6.87457C7.49217 22.2783 8.06664 22.6028 8.37799 23.1363C8.68934 23.6697 8.68934 24.3295 8.37799 24.863C8.06664 25.3964 7.49217 25.7209 6.87457 25.7122H1.73693C1.11933 25.7209 0.544865 25.3964 0.233513 24.863C-0.0778378 24.3295 -0.0778378 23.6697 0.233513 23.1363ZM41.1254 22.287C40.5078 22.2783 39.9334 22.6028 39.622 23.1363C39.3107 23.6697 39.3107 24.3295 39.622 24.863C39.9334 25.3964 40.5078 25.7209 41.1254 25.7122H46.2631C46.8807 25.7209 47.4551 25.3964 47.7665 24.863C48.0778 24.3295 48.0778 23.6697 47.7665 23.1363C47.4551 22.6028 46.8807 22.2783 46.2631 22.287H41.1254ZM10.681 34.8972C10.9911 34.5779 11.4134 34.392 11.8583 34.3787C12.5644 34.3579 13.2108 34.7727 13.4861 35.4232C13.7614 36.0737 13.6091 36.8265 13.1026 37.3189L9.47014 40.9514C9.0406 41.3988 8.40277 41.579 7.80264 41.4225C7.2025 41.2661 6.73383 40.7974 6.57738 40.1972C6.42092 39.5971 6.60113 38.9593 7.04849 38.5297L10.681 34.8972ZM36.0915 34.3787C35.3946 34.3789 34.7673 34.8013 34.5051 35.447C34.2429 36.0926 34.398 36.8328 34.8974 37.3189L38.5299 40.9514C38.9594 41.3988 39.5972 41.579 40.1974 41.4225C40.7975 41.266 41.2662 40.7974 41.4226 40.1972C41.5791 39.5971 41.3989 38.9593 40.9515 38.5297L37.319 34.8972C36.9966 34.5657 36.5539 34.3787 36.0915 34.3787ZM22.2875 41.1253C22.2745 40.1808 23.0287 39.4041 23.9732 39.3893C24.4361 39.3821 24.8822 39.5626 25.2099 39.8896C25.5376 40.2167 25.7189 40.6624 25.7125 41.1253V46.263C25.7213 46.8806 25.3968 47.4551 24.8633 47.7665C24.3299 48.0778 23.6701 48.0778 23.1367 47.7665C22.6032 47.4551 22.2787 46.8806 22.2875 46.263V41.1253Z";

let light =
  "M28.28 0.000217023C27.3043 0.0155355 26.5251 0.82138 26.5385 1.80138V3.57825H24.7692C24.1312 3.56919 23.5377 3.90586 23.216 4.45935C22.8944 5.01284 22.8944 5.6974 23.216 6.25089C23.5377 6.80438 24.1312 7.14105 24.7692 7.13199H26.5385V8.90886C26.5294 9.54966 26.8647 10.1457 27.4158 10.4688C27.9669 10.7918 28.6485 10.7918 29.1996 10.4688C29.7507 10.1457 30.0859 9.54966 30.0769 8.90886V7.13199H31.8462C32.4842 7.14105 33.0777 6.80438 33.3993 6.25089C33.721 5.6974 33.721 5.01284 33.3993 4.45935C33.0777 3.90586 32.4842 3.56919 31.8462 3.57825H30.0769V1.80138C30.0835 1.32109 29.8961 0.858597 29.5576 0.519277C29.2191 0.179957 28.7583 -0.00728444 28.28 0.000217023ZM16.6142 5.87569C7.11164 7.99549 0 16.4961 0 26.6776C0 38.4529 9.50608 48 21.2308 48C31.3685 48 39.8325 40.8577 41.9432 31.3141C39.2257 32.8777 36.087 33.785 32.7308 33.785C22.471 33.785 14.1538 25.432 14.1538 15.1279C14.1538 11.7572 15.0573 8.60496 16.6142 5.87569ZM37.1538 14.2395C37.1538 13.2586 37.9465 12.4626 38.9231 12.4626C39.8997 12.4626 40.6923 13.2586 40.6923 14.2395V16.0163C40.6923 16.9972 41.4849 17.7932 42.4615 17.7932H44.2308C45.2074 17.7932 46 18.5892 46 19.5701C46 20.5509 45.2074 21.347 44.2308 21.347H42.4615C41.4849 21.347 40.6923 22.143 40.6923 23.1238V24.9007C40.6923 25.8815 39.8997 26.6776 38.9231 26.6776C37.9465 26.6776 37.1538 25.8815 37.1538 24.9007V23.1238C37.1538 22.143 36.3612 21.347 35.3846 21.347H33.6154C32.6388 21.347 31.8462 20.5509 31.8462 19.5701C31.8462 18.5892 32.6388 17.7932 33.6154 17.7932H35.3846C36.3612 17.7932 37.1538 16.9972 37.1538 16.0163V14.2395Z";

const paths = [light, dark];
const colors = ["#1a1a1a", "#ffffff"];

export default function ThemeToggle() {
  const [pathIndex, setPathIndex] = useState(0);
  const progress = useMotionValue(pathIndex);
  const fill = useTransform(progress, paths.map(getIndex), colors);
  const path = useFlubber(progress, paths);

  React.useEffect(() => {
    const animation = animate(progress, pathIndex, {
      duration: 0.3,
      ease: "easeInOut",
      onComplete: () => {},
    });

    return () => animation.stop();
  }, [pathIndex]);

  const [activeTheme, setActiveTheme] = useState("light");
  const inactiveTheme = activeTheme === "light" ? "dark" : "light";

  const switchTheme = () => {
    setActiveTheme(inactiveTheme);

    if (pathIndex === 0) {
      progress.set(0);
      setPathIndex(1);
    } else {
      setPathIndex(0);
    }

    console.log(pathIndex);
  };

  useEffect(() => {
    const savedTheme = window.localStorage.getItem("theme");
    savedTheme && setActiveTheme(savedTheme);
  }, []);

  useEffect(() => {
    document.body.dataset.theme = activeTheme;
    window.localStorage.setItem("theme", activeTheme);
  }, [activeTheme]);

  return (
    <motion.div
      initial={{ opacity: 0 }}
      whileInView={{ opacity: 1 }}
      viewport={{ once: true }}
      transition={{ duration: 0.6 }}
    >
      <div className="" onClick={() => switchTheme()}>
        <svg width="24" height="24">
          <g transform=" scale(0.5)">
            <motion.path fill={fill} d={path} />
          </g>
        </svg>
      </div>
    </motion.div>
  );
}
